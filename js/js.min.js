var $cd={ajax:function(a){a=a||{};a.type=(a.type||"GET").toUpperCase();a.dataType=a.dataType||"json";var b=formatParams(a.data),c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){if(4==c.readyState){var b=c.status;200<=b&&300>b?a.success&&a.success(c.responseText,c.responseXML):a.fail&&a.fail(b)}};"GET"==a.type?(c.open("GET",a.url+"?"+b,!0),c.send(null)):"POST"==a.type&&(c.open("POST",a.url,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),
    c.send(b))}};function formatParams(a){var b=[],c;for(c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}
!function(a){var b=function(a,c){var b=new Image,d=a.src||a;"data:"!==d.substring(0,5)&&(b.crossOrigin="Anonymous");b.onload=function(){var a=document.createElement("canvas").getContext("2d");a.drawImage(b,0,0);a=a.getImageData(0,0,b.width,b.height);c&&c(a.data)};b.src=d},c=function(a){return a.map(function(a){return["rgb(",a.name,")"].join("")})},d={colors:function(a,d){d=d||{};var q=d.exclude||[],r=d.paletteSize||10;b(a,function(b){for(var t=a.width*a.height||b.length,h={},e="",k=[],m="",n=0,p=
    Array.apply(null,Array(r)).map(Boolean).map(function(){return{name:"0,0,0",count:0}}),f=0;t>f;){if(k[0]=b[f],k[1]=b[f+1],k[2]=b[f+2],e=k.join(","),h[e]=e in h?h[e]+1:1,-1===q.indexOf(["rgb(",e,")"].join(""))){var l=h[e];l>n?(m=e,n=l):p.some(function(a){return l>a.count?(a.name=e,a.count=l,!0):void 0})}f+=20}d.success&&(b=c(p),d.success({dominant:["rgb(",m,")"].join(""),secondary:b[0],palette:b}))})}};a.RGBaster=a.RGBaster||d}(window);var $cdfm={};$cdfm.cdp=document.getElementById("main-player");
$cdfm.playPauseBtn=document.getElementById("ctrl-play-pause");$cdfm.pauseBtn=document.getElementById("ctrl-pause");$cdfm.processMinute=document.getElementById("process-minute");$cdfm.processSecond=document.getElementById("process-second");$cdfm.processInner=document.getElementsByClassName("process-inner")[0];$cdfm.processWrapper=document.getElementsByClassName("process-wrapper")[0];$cdfm.title=document.getElementsByClassName("title")[0];$cdfm.subTitle=document.getElementsByClassName("subtitle")[0];
$cdfm.artist=document.getElementsByClassName("artist")[0];$cdfm.cover=document.getElementsByClassName("cover")[0];$cdfm.vData={};$cdfm.hash=[];$cdfm.coverImg=document.getElementById("cover-img");$cdfm.idIn=document.getElementById("id-in");$cdfm.so=document.getElementById("so");$cdfm.oldHash="/";$cdfm.curPlaying=0;$cdfm.forwordBtn=document.getElementById("ctrl-fwd");$cdfm.backwordBtn=document.getElementById("ctrl-bwd");$cdfm.hktSrc="";$cdfm.lrcSrc=[];$cdfm.curLrc=0;$cdfm.lrcDom=document.getElementsByClassName("lrc")[0];
$cdfm.colorChangeDoms=document.getElementsByClassName("color-change");window.onload=function(){$cdfm.hashChange();window.onhashchange=$cdfm.hashChange;$cdfm.cdp.oncanplaythrough=$cdfm.ready2Play;$cdfm.cdp.ontimeupdate=$cdfm.updateTime;$cdfm.processWrapper.onclick=$cdfm.fly;$cdfm.playPauseBtn.disabled=!0;$cdfm.playPauseBtn.onclick=$cdfm.playPause;$cdfm.forwordBtn.onclick=$cdfm.forword;$cdfm.backwordBtn.onclick=$cdfm.backword;$cdfm.so.onclick=$cdfm.doso;$cdfm.cdp.onended=$cdfm.forword};
$cdfm.hashChange=function(){$cdfm.hash=location.hash.substr(2).split("/");$cdfm.oldHash!=location.hash&&($cdfm.playPause(!1),"song"==$cdfm.hash[0]?$cd.ajax({url:"http://m163.proxy.izhai.net/api/song/detail/",data:{ids:"["+$cdfm.hash[1]+"]"},success:function(a,b){var c=JSON.parse(a);200==c.code&&0<c.songs.length?($cdfm.oldHash=location.hash,$cdfm.vData=c,$cdfm.curPlaying=0,$cdfm.newSong()):(location.hash="/list/"+$cdfm.hash[1],$cdfm.playPause(!0))}}):"list"==$cdfm.hash[0]?$cd.ajax({url:"http://m163.proxy.izhai.net/api/playlist/detail/",
    data:{id:$cdfm.hash[1]},success:function(a,b){var c=JSON.parse(a);if(200==c.code){$cdfm.vData={songs:[]};for(var d in c.result.tracks)$cdfm.vData.songs.push(c.result.tracks[d]);$cdfm.oldHash=location.hash;$cdfm.curPlaying=0;$cdfm.newSong()}else location.hash=$cdfm.oldHash,$cdfm.playPause(!0)}}):location.hash="/list/85043989")};
$cdfm.newSong=function(){console.log("Preparing a new song");$cdfm.cdp.src=$cdfm.vData.songs[$cdfm.curPlaying].mp3Url;$cdfm.changeInnerHTML($cdfm.title,$cdfm.vData.songs[$cdfm.curPlaying].name);$cdfm.vData.songs[$cdfm.curPlaying].alias[0]?$cdfm.changeInnerHTML($cdfm.subTitle,$cdfm.vData.songs[$cdfm.curPlaying].alias[0]):(console.log("\u6b21\u306e\u66f2\u304c\u59cb\u307e\u308b\u3067\u3059"),$cdfm.hktSrc=document.createElement("script"),$cdfm.hktSrc.setAttribute("src","http://api.hitokoto.us/rand?encode=jsc&fun=showHitokoto"),
    document.body.appendChild($cdfm.hktSrc));$cdfm.changeInnerHTML($cdfm.artist,$cdfm.vData.songs[$cdfm.curPlaying].artists[0].name);$cdfm.cover.style.backgroundImage="url("+$cdfm.vData.songs[$cdfm.curPlaying].album.picUrl+")";$cdfm.coverImg.src=$cdfm.vData.songs[$cdfm.curPlaying].album.picUrl;$cdfm.cdp.load();$cdfm.curLrc=0;$cdfm.getLrc();$cdfm.lrcDom.innerHTML="";$cdfm.changeTitle($cdfm.title.innerHTML);$cdfm.playPause(!0);RGBaster.colors($cdfm.vData.songs[$cdfm.curPlaying].album.picUrl.replace(/music\.126\.net/g,
    "m163.proxy.izhai.net"),{exclude:["rgb(255,255,255)","rgb(0,0,0)"],success:function(a){document.getElementsByTagName("body")[0].style.backgroundColor=a.dominant;$cdfm.changeColor(a.dominant)}})};$cdfm.ready2Play=function(){console.log("Ready to Play \u221a");$cdfm.playPauseBtn.innerHTML="";$cdfm.cdp.paused?($cdfm.playPauseBtn.classList.add("fa-play"),$cdfm.playPauseBtn.classList.remove("fa-pause")):($cdfm.playPauseBtn.classList.add("fa-pause"),$cdfm.playPauseBtn.classList.remove("fa-play"))};
$cdfm.updateTime=function(a){$cdfm.processMinute.innerHTML=10>($cdfm.cdp.currentTime/60).toFixed(0)?"0"+($cdfm.cdp.currentTime/60).toFixed(0):($cdfm.cdp.currentTime/60).toFixed(0);$cdfm.processSecond.innerHTML=10>($cdfm.cdp.currentTime%60).toFixed(0)?"0"+($cdfm.cdp.currentTime%60).toFixed(0):($cdfm.cdp.currentTime%60).toFixed(0);$cdfm.processInner.style.width=$cdfm.cdp.currentTime/$cdfm.cdp.duration*100+"%";$cdfm.showLrc()};
$cdfm.fly=function(a){$cdfm.cdp.currentTime=a.offsetX/$cdfm.processWrapper.offsetWidth*$cdfm.cdp.duration;$cdfm.curLrc=0};$cdfm.playPause=function(a){$cdfm.cdp.paused&&a?($cdfm.cdp.play(),$cdfm.cover.style.animationPlayState="running",$cdfm.playPauseBtn.classList.add("fa-pause"),$cdfm.playPauseBtn.classList.remove("fa-play")):($cdfm.cdp.pause(),$cdfm.cover.style.animationPlayState="paused",$cdfm.playPauseBtn.classList.add("fa-play"),$cdfm.playPauseBtn.classList.remove("fa-pause"))};
$cdfm.changeTitle=function(a){var b=document.title.split("|");b[1]=a;document.title=b.join("|")};$cdfm.doso=function(){$cdfm.idIn.value&&(location.hash="/song/"+$cdfm.idIn.value,$cdfm.idIn.value="")};$cdfm.forword=function(){++$cdfm.curPlaying<$cdfm.vData.songs.length||($cdfm.curPlaying=0);$cdfm.newSong()};$cdfm.backword=function(){0<=--$cdfm.curPlaying||($cdfm.curPlaying=0);$cdfm.newSong()};
$cdfm.getLrc=function(){$cd.ajax({url:"http://m163.proxy.izhai.net/api/song/lyric",data:{id:$cdfm.vData.songs[$cdfm.curPlaying].id,lv:"-1"},success:function(a,b){var c=JSON.parse(a);$cdfm.lrcSrc=[];if(200==c.code&&c.lrc){var c=c.lrc.lyric.split("\n"),d;for(d in c){var g=/\[([0-9]+):([0-9]+)\.([0-9]+)\](.*)/g.exec(c[d]);try{$cdfm.lrcSrc.push([parseFloat(60*g[1]+parseFloat(g[2])+"."+g[3]),g[4]])}catch(u){}}}}})};
$cdfm.showLrc=function(){if(0<$cdfm.lrcSrc.length)try{for(;$cdfm.lrcSrc[$cdfm.curLrc][0]-.5<$cdfm.cdp.currentTime;)$cdfm.curLrc++;$cdfm.lrcDom.innerHTML!=$cdfm.lrcSrc[$cdfm.curLrc-1][1]&&$cdfm.changeInnerHTML($cdfm.lrcDom,$cdfm.lrcSrc[$cdfm.curLrc-1][1])}catch(a){}else"\u5c3d\u5728\u4e0d\u8a00\u4e2d"!=$cdfm.lrcDom.innerHTML&&($cdfm.lrcDom.innerHTML="\u5c3d\u5728\u4e0d\u8a00\u4e2d")};
$cdfm.changeColor=function(a){a=a.substring(4,a.length-1).split(",");for(var b in $cdfm.colorChangeDoms)try{$cdfm.colorChangeDoms[b].style.color="rgb("+(255-parseInt(a[0]))+","+(255-parseInt(a[1]))+","+(255-parseInt(a[2]))+")"}catch(c){}};$cdfm.changeInnerHTML=function(a,b){a.style.opacity=0;setTimeout(function(){a.innerHTML=b;a.style.opacity=1},500)};
function showHitokoto(a){$cdfm.vData.songs[$cdfm.curPlaying].alias[0]||$cdfm.changeInnerHTML($cdfm.subTitle,a.hitokoto);try{document.getElementsByTagName("body")[0].removeChild($cdfm.hktSrc)}catch(b){}};